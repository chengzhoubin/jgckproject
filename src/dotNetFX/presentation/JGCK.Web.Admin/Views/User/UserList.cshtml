@using Webdiyer.WebControls.Mvc
@using JGCK.Util
@model JGCK.Web.Admin.Models.VmUserStaffIndex
<div class="page-bar">
    <ul class="page-breadcrumb">
        <li>
            <a href="#">基础管理</a>
            <i class="fa fa-circle"></i>
        </li>
        <li>
            <span>员工管理</span>
        </li>
    </ul>
    <div class="page-toolbar">
        <div class="btn-group pull-right">
            <button type="button" class="btn green btn-sm btn-outline"> 新增 </button>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-md-12">
        <!-- BEGIN SAMPLE TABLE PORTLET-->
        <div class="portlet light">
            <div class="portlet-body">
                <div class="table-toolbar">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                <!--<label>Small Input Default Group</label>-->
                                <div class="input-group input-group-sm">
                                    @Html.TextBoxFor(m => m.Filter, new { @class = "form-control", placeholder = "姓名、电话" })
                                    <span class="input-group-btn">
                                        <button id="btnSearch" class="btn green" type="button">搜索</button>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <style>
                        .ul-person li {
                            list-style: none;
                            float: left;
                            margin: 10px;
                        }

                            .ul-person li .item {
                                display: inline-block;
                                height: 50px;
                                color: #fff;
                                background-color: #ff8666;
                                padding: 15px;
                                border-radius: 5px !important;
                                overflow: hidden;
                            }
                    </style>
                    <table class="table table-striped table-bordered table-hover dataTable" id="sample_1">
                        <thead>
                            <tr>
                                <th> 序号 </th>
                                <th @@click="click_setsort('RealName')" :class="get_sortCLass('Role.Name')"> 角色 </th>
                                <th @@click="click_setsort('DepartmentName')" :class="get_sortCLass('DepartmentName')"> 所属部门 </th>
                                <th @@click="click_setsort('PersonType')" :class="get_sortCLass('PersonType')"> 员工类型	 </th>
                                <th @@click="click_setsort('Name')" :class="get_sortCLass('Name')"> 用户名 </th>
                                <th @@click="click_setsort('RealName')" :class="get_sortCLass('RealName')"> 姓名 </th>
                                <th> 性别 </th>
                                <th> 学历 </th>
                                <th> 毕业学校 </th>
                                <th> 专业 </th>
                                <th> 联系电话 </th>
                                <th> 操作 </th>
                            </tr>
                        </thead>
                        <tbody>
                            @{
                                if (Model != null && Model.ViewObjects != null)
                                {
                                    var itemIndex = 1;
                                    foreach (var item in Model.ViewObjects)
                                    {
                                        <tr>
                                            <td> @(Model.CurrentIndex * Model.PageSize + itemIndex) </td>
                                            <td> @item.NagigatedDomainObject.Role.Name </td>
                                            <td> @item.NagigatedDomainObject.DepartmentName </td>
                                            <td> @item.NagigatedDomainObject.PersonType.ToDescription() </td>
                                            <td> @item.NagigatedDomainObject.Name </td>
                                            <td> @item.NagigatedDomainObject.RealName </td>
                                            <td> @item.NagigatedDomainObject.Sex.ToDescription() </td>
                                            <td> @item.NagigatedDomainObject.Education.ToDescription() </td>
                                            <td> @item.NagigatedDomainObject.GraduateInstitution </td>
                                            <td> @item.NagigatedDomainObject.Major </td>
                                            <td> @item.NagigatedDomainObject.Phone </td>
                                            <td> <button type="button" class="btn green btn-sm" @@click="click_showDoctorPop(@(item.HiddenJsonString))"> 编辑 </button> </td>
                                        </tr>
                                        itemIndex++;
                                    }
                                }
                            }
                        </tbody>
                    </table>

                    <div>
                        @Html.Pager(Model.TotalRecordCount, Model.PageSize, Model.CurrentIndex, new PagerOptions
                        {
                            PageIndexParameterName = "p",
                            ContainerTagName = "ul",
                            CssClass = "pagination pagination-sm",
                            CurrentPagerItemTemplate = "<li class=\"active\"><a href=\"javascript:; \"> {0} </a></li>",
                            DisabledPagerItemTemplate = "<li><a href=\"javascript:; \"> {0} </a></li>",
                            PagerItemTemplate = "<li>{0}</li>"
                        })
                    </div>
                </div>
            </div>
            <!-- END SAMPLE TABLE PORTLET-->
        </div>
    </div>
</div>

<div class="modal fade" id="modelfull" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-full">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                <h4 class="modal-title">员工信息</h4>
            </div>
            <div class="modal-body">
                <div class="FormBody">
                    <div class="row">
                        <div class="col-xs-3">
                            <ul class="list-unstyled">
                                <li> <strong>角色:</strong> <input type="text" v-model="doctor.RealName" /></li>
                            </ul>
                        </div>
                        <div class="col-xs-3">
                            <ul class="list-unstyled">
                                <li> <strong>所属部门:</strong>  <input type="text" v-model="doctor.DepartmentName" /></li>
                            </ul>
                        </div>
                        <div class="col-xs-3">
                            <ul class="list-unstyled">
                                <li>
                                    <strong>用户名:</strong><input type="text" v-model="doctor.Name" />
                                </li>
                            </ul>
                        </div>
                        <div class="col-xs-3">
                            <ul class="list-unstyled">
                                <li>
                                    <strong>密码:</strong> <input type="text" />
                                </li>
                            </ul>
                        </div>
                    </div>
                    <hr />
                    <div class="row">
                        <div class="col-xs-3">
                            <ul class="list-unstyled">
                                <li>
                                    <strong>员工类型:</strong>
                                    {{doctor.PersonType}}
                                    <select v-model="doctor.PersonType">
                                        <option v-for="(item,index) in ListPersonType" :value="item.id">{{item.name}}</option>
                                    </select>
                                </li>
                            </ul>
                        </div>
                        <div class="col-xs-3">
                            <ul class="list-unstyled">
                                <li> <strong>姓名:</strong> <input type="text" v-model="doctor.RealName" /></li>
                            </ul>
                        </div>
                        <div class="col-xs-3">
                            <ul class="list-unstyled">
                                <li>
                                    <strong>性别:</strong>
                                    @{
                                        var sexHtmlAttribute = new Dictionary<string, object>();
                                        sexHtmlAttribute.Add("v-model", "doctor.Sex");
                                    }
                                    @Html.DropDownListFor(m => m.Sex, Model.SexList, sexHtmlAttribute)
                                    @*<select v-model="doctor.Sex">
                                        <option value="1">男</option>
                                        <option value="2">女</option>
                                    </select>*@
                                    {{doctor.Sex}}
                                </li>
                            </ul>
                        </div>
                        <div class="col-xs-3">
                            <ul class="list-unstyled">
                                <li>
                                    <strong>身份证号:</strong> <input type="text" v-model="doctor.IdCard" />
                                </li>
                            </ul>
                        </div>
                    </div>
                    <hr />
                    <div class="row">
                        <div class="col-xs-3">
                            <ul class="list-unstyled">
                                <li class="form-inline">
                                    <strong>入职时间:</strong>
                                    @*<input type="text" v-model="doctor.HireDate" />*@
                                    <div class="form-group">
                                        <div class="input-group date form_datetime">
                                            <input class="form-control" readonly="readonly" size="16" type="text" v-model="doctor.HireDate" />
                                            <span class="input-group-btn">
                                                <button class="btn default date-set" type="button">
                                                    <i class="fa fa-calendar"></i>
                                                </button>
                                            </span>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                        <div class="col-xs-3">
                            <ul class="list-unstyled">
                                <li class="form-inline">
                                    <strong>离职时间:</strong>
                                    @*<input type="text" v-model="doctor.LeaveDate" />*@
                                    <div class="form-group">
                                        <div class="input-group date form_datetime">
                                            <input class="form-control" readonly="readonly" size="16" type="text" v-model="doctor.LeaveDate" />
                                            <span class="input-group-btn">
                                                <button class="btn default date-set" type="button">
                                                    <i class="fa fa-calendar"></i>
                                                </button>
                                            </span>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                        <div class="col-xs-3">
                            <ul class="list-unstyled">
                                <li class="form-inline">
                                    <strong>实习开始时间:</strong>
                                    @*<input type="text" v-model="doctor.PracticeBeginDate" />*@
                                    <div class="form-group">
                                        <div class="input-group date form_datetime">
                                            <input class="form-control" readonly="readonly" size="16" type="text" v-model="doctor.PracticeBeginDate" />
                                            <span class="input-group-btn">
                                                <button class="btn default date-set" type="button">
                                                    <i class="fa fa-calendar"></i>
                                                </button>
                                            </span>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                        <div class="col-xs-3">
                            <ul class="list-unstyled">
                                <li class="form-inline">
                                    <strong>实习结束时间:</strong>
                                    @*<input type="text" v-model="doctor.PracticeEndDate" />*@
                                    <div class="form-group">
                                        <div class="input-group date form_datetime">
                                            <input class="form-control" readonly="readonly" size="16" type="text" v-model="doctor.PracticeEndDate" />
                                            <span class="input-group-btn">
                                                <button class="btn default date-set" type="button">
                                                    <i class="fa fa-calendar"></i>
                                                </button>
                                            </span>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <hr />
                    <div class="row">
                        <div class="col-xs-3">
                            <ul class="list-unstyled">
                                <li> <strong>学历:</strong> <input type="text" v-model="doctor.Education" /> </li>
                            </ul>
                        </div>
                        <div class="col-xs-3">
                            <ul class="list-unstyled">
                                <li> <strong>毕业学校:</strong> <input type="text" v-model="doctor.GraduateInstitution" /></li>
                            </ul>
                        </div>
                        <div class="col-xs-3">
                            <ul class="list-unstyled">
                                <li>
                                    <strong>专业:</strong><input type="text" v-model="doctor.Major" />
                                </li>
                            </ul>
                        </div>
                    </div>
                    <hr />
                    <div class="row">
                        <div class="col-xs-3">
                            <ul class="list-unstyled">
                                <li> <strong>联系电话:</strong> <input type="text" v-model="doctor.Phone" /> </li>
                            </ul>
                        </div>
                        <div class="col-xs-3">
                            <ul class="list-unstyled">
                                <li> <strong>紧急联系人:</strong> <input type="text" v-model="doctor.EmergencyContact" /></li>
                            </ul>
                        </div>
                        <div class="col-xs-3">
                            <ul class="list-unstyled">
                                <li>
                                    <strong>紧急联系人电话:</strong><input type="text" v-model="doctor.EmergencyPhone" />
                                </li>
                            </ul>
                        </div>
                    </div>
                    <hr />
                    <div class="row">
                        <div class="col-xs-12">
                            <ul class="list-unstyled">
                                <li>
                                    <strong style="float:left;">备注:</strong>
                                    <script id="container" name="content" type="text/plain" style="width: 1000px;">
                                    </script>
                                </li>
                            </ul>
                            </d
                            <hr />
                            <div class="row">
                                <div class="col-xs-12">
                                    <ul class="list-unstyled">
                                        <li>
                                            <strong>备注:</strong>
                                            注：

                                            1。员工类型，只做显示，不做操作。<br />

                                            判定规则 ：<br />

                                            ａ）正式在职：有入职时间 ，没有离职时间<br />

                                            ｂ）正式离职：有入职时间，有离职时间<br />

                                            Ｃ）实习在职：没有入职时间，没有离职时间。有实习开始时间，没有实习结束时间<br />
                                            Ｄ）实习离职：没有入职时间，没有离职时间。有实习开始时间，有实习结束时间<br />

                                            Ｆ）实习转正：有入职时间，没有离职时间。有实习开始时间，没有实习结束时间<br />

                                            ２。密码操作：<br />

                                            ａ）密码为空时，不作密码修改<br />

                                            ｂ）输入新密码时，作密码修改<br />

                                            3。删除操作：（具体等我和用户讨论在定）<br />


                                        </li>
                                    </ul>
                                </div>
                            </div>

                        </div>


                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn green" @@click="click_save">保存</button>
                        <button type="button" class="btn dark btn-outline" data-dismiss="modal">关闭</button>
                    </div>
                </div>
                <!-- /.modal-content -->
            </div>
            <!-- /.modal-dialog -->
        </div>



        @section referenceHeader{
            <script>
                var pageUrl = "/User/UserList"
            </script>
            <link href="~/assets/global/plugins/bootstrap-daterangepicker/daterangepicker.min.css" rel="stylesheet" type="text/css" />
            <link href="~/assets/global/plugins/bootstrap-datepicker/css/bootstrap-datepicker3.min.css" rel="stylesheet" type="text/css" />
            <link href="~/assets/global/plugins/bootstrap-timepicker/css/bootstrap-timepicker.min.css" rel="stylesheet" type="text/css" />
            <link href="~/assets/global/plugins/bootstrap-datetimepicker/css/bootstrap-datetimepicker.min.css" rel="stylesheet" type="text/css" />
            <link rel="stylesheet" href="~/assets/global/plugins/umeditor/themes/default/css/umeditor.css">
            <style>
                .FormBody li strong {
                    width: 140px;
                    display: inline-block;
                }

                .edui-container {
                    display: inline-block;
                }
            </style>
        }

        @section scripts
{
            <script src="~/assets/global/plugins/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js" type="text/javascript"></script>
            <script src="~/assets/global/plugins/bootstrap-datetimepicker/js/locales/bootstrap-datetimepicker.zh-CN.js"></script>
            <script type="text/javascript" src="~/assets/global/plugins/umeditor/third-party/template.min.js"></script>
            <script type="text/javascript" src="~/assets/global/plugins/umeditor/umeditor.config.js"></script>
            <script type="text/javascript" src="~/assets/global/plugins/umeditor/umeditor.js"></script>
            <script>
        $(function() {
            $("#btnSearch").click(function () {
                if ($("#Filter").val() == "") {
                    location.href = '@Url.Action("UserList")';
                    return;
                }
                var reloadUrlWithFilter = '@Url.Action("UserList")?filter=' + encodeURI($("#Filter").val());
                location.href = reloadUrlWithFilter;
            });
            handleDatetimePicker();
            $(function () {
                var um = UM.getEditor('container', {});
            });

        })
        var handleDatetimePicker = function () {
            if (!jQuery().datetimepicker) {
                return;
            }
            var date = new Date();
            $(".form_datetime").datetimepicker({
                autoclose: true,
                isRTL: App.isRTL(),
                format: " yyyy-mm-dd hh:ii",
                startDate: '2018-1-1',
                todayHighlight: true,
                language: "zh-CN",
                pickerPosition: (App.isRTL() ? "bottom-right" : "bottom-left")
            });
            $('body').removeClass("modal-open");
        }
        var formatTime = function (value, needTime = true) {
            return value == "" || value == null || value == '1900-01-01T00:00:00' ? "" : moment(value).format(needTime ? "YYYY-MM-DD HH:mm" : "MM/DD/YYYY");
        }

        var app = new Vue({
            el: '#app',
            data: {
                doctor: "",
                ListPersonType: [{ id: 1, name: '在职' }, { id: 2, name: '离职' }, { id: 4, name: '其他' }],
                sexList: [{ name: "男", value: "1" }, { name: "女", value: "2" }]
            },
            methods: {
                get_sortCLass: function (sortName) {
                    var _tmp = _.where(this.sort_keys, { SortProperty: sortName });
                    if (_tmp.length === 0) return 'sorting';
                    return (_tmp && _tmp.length > 0 && _tmp[0].SortDirect === 1 ? "sorting_desc" : "sorting_asc");
                },
                click_showDoctorPop: function (doctorObj) {
                    if (doctorObj.NagigatedDomainObject.HireDate) doctorObj.NagigatedDomainObject.HireDate = formatTime(doctorObj.NagigatedDomainObject.HireDate)
                    if (doctorObj.NagigatedDomainObject.LeaveDate) doctorObj.NagigatedDomainObject.LeaveDate = formatTime(doctorObj.NagigatedDomainObject.LeaveDate)
                    if (doctorObj.NagigatedDomainObject.PracticeBeginDate) doctorObj.NagigatedDomainObject.PracticeBeginDate = formatTime(doctorObj.NagigatedDomainObject.PracticeBeginDate)
                    if (doctorObj.NagigatedDomainObject.PracticeEndDate) doctorObj.NagigatedDomainObject.PracticeEndDate = formatTime(doctorObj.NagigatedDomainObject.PracticeEndDate)
                    this.doctor = doctorObj.NagigatedDomainObject
                    $('#modelfull').modal('show')

                    console.log(this.doctor)
                },
                click_setsort: function (Name) {

                    var _tmp = _.where(this.sort_keys, { SortProperty: Name });
                    var SortDirect = (_tmp && _tmp.length > 0 && _tmp[0].SortDirect === 1 ? "Desc" : "Asc");
                    Cookies.remove('sf_staffData_sort_keys');
                    $.post("/ajaxcommon/setsort/", {
                        "module": "sf_staffData_sort_keys",
                        "sortby": Name,
                        "directby": SortDirect
                    }).then(item => {
                         window.location.reload();
                    });
                },
                click_save: function () {
                    console.log(this.doctor)
                    $.post("/user/updatedoctor   ", {
                        NagigatedDomainObject: this.doctor
                    }).then(item => {
                        console.log(item)
                        // window.location.reload();
                    });
                }

            }
        })
            </script>

            
        }
