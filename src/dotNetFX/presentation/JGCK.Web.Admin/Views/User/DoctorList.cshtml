@using Webdiyer.WebControls.Mvc
@using JGCK.Util
@model JGCK.Web.Admin.Models.VmUserDoctorIndex
<div class="page-bar">
    <ul class="page-breadcrumb">
        <li>
            <a href="#">基础管理</a>
            <i class="fa fa-circle"></i>
        </li>
        <li>
            <span>医生信息管理</span>
        </li>
    </ul>
    <div class="page-toolbar">
        <div class="btn-group pull-right">
            @*<button type="button" class="btn green btn-sm btn-outline"> 新增 </button>*@
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <div class="portlet light">
            <div class="portlet-body">
                <div class="table-toolbar">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                <div class="input-group input-group-sm">
                                    @Html.TextBoxFor(m => m.Filter, new { @class = "form-control", placeholder = "姓名、医生编号、手机" })
                                    <span class="input-group-btn">
                                        <button id="btnSearch" class="btn green" type="button">搜索</button>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <table class="table table-striped table-bordered table-hover dataTable" id="sample_1">
                        <thead>
                            <tr>
                                @*class="sorting_asc"
                                class="sorting_desc"*@
                                <th> 序号 </th>
                                <th @@click="click_setsort('RealName')" :class="{'sorting_asc':SortDirect_RealName=='Asc','sorting_desc':SortDirect_RealName=='Desc','sorting':SortDirect_RealName==''}"> 医生姓名 </th>
                                <th> 医生编号 </th>
                                <th> 固定电话 </th>
                                <th> 手机 </th>
                                <th @@click="click_setsort('Doctor.AuditStatus')" :class="{'sorting_asc':SortDirect_AuditStatus=='Asc','sorting_desc':SortDirect_AuditStatus=='Desc','sorting':SortDirect_AuditStatus==''}"> 审核状态 </th>
                                <th> 审核时间 </th>
                                <th> 操作 </th>
                            </tr>
                        </thead>
                        <tbody>
                            @{
                                if (Model != null && Model.ViewObjects != null)
                                {
                                    var itemIndex = 1;
                                    foreach (var item in Model.ViewObjects)
                                    {
                                        <tr>
                                            <td> @(Model.CurrentIndex * Model.PageSize + itemIndex) </td>
                                            <td> @item.NagigatedDomainObject.RealName </td>
                                            <td> @item.NagigatedDomainObject.Doctor.DoctorCode </td>
                                            <td> @item.NagigatedDomainObject.Doctor.LinePhone </td>
                                            <td> @item.NagigatedDomainObject.Doctor.MobilePhone </td>
                                            <td> @item.NagigatedDomainObject.Doctor.AuditStatus.ToDescription() </td>
                                            <td> @item.NagigatedDomainObject.Doctor.AuditDate </td>
                                            <td> <button type="button" class="btn green btn-sm" @@click="click_showDoctorPop(@(item.HiddenJsonString))"> 编辑 </button> </td>
                                        </tr>
                                        itemIndex++;
                                    }
                                }
                            }
                        </tbody>
                    </table>

                    <div>
                        @Html.Pager(Model.TotalRecordCount, Model.PageSize, Model.CurrentIndex, new PagerOptions
                        {
                            PageIndexParameterName = "p",
                            ContainerTagName = "ul",
                            CssClass = "pagination pagination-sm",
                            CurrentPagerItemTemplate = "<li class=\"active\"><a href=\"javascript:; \"> {0} </a></li>",
                            DisabledPagerItemTemplate = "<li><a href=\"javascript:; \"> {0} </a></li>",
                            PagerItemTemplate = "<li>{0}</li>"
                        })
                    </div>
                </div>
            </div>
            <!-- END SAMPLE TABLE PORTLET-->
        </div>
    </div>
</div>


<div class="modal fade" id="modelfull" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-full">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                <h4 class="modal-title">医生信息</h4>
            </div>
            <div class="modal-body">

                <div class="invoice">
                    <div class="row">
                        <div class="col-xs-3">
                            <ul class="list-unstyled">
                                <li> <strong>医生姓名:</strong>  {{doctorObj.RealName}} </li>
                            </ul>
                        </div>
                        <div class="col-xs-3">
                            <ul class="list-unstyled">
                                <li> <strong>医生编号:</strong> {{doctorObj.Doctor.DoctorCode}}</li>
                            </ul>
                        </div>
                        <div class="col-xs-3">
                            <ul class="list-unstyled">
                                <li>
                                    <strong>用户名:</strong> {{doctorObj.Name}}
                                </li>
                            </ul>
                        </div>
                        <div class="col-xs-3">
                            <button type="button" class="btn green">通过</button>
                            <button type="button" class="btn yellow">不通过</button>
                            <button type="button" class="btn red">删除</button>
                        </div>
                    </div>
                    <hr />
                    <div class="row">
                        <div class="col-xs-12">
                            <table class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th> # </th>
                                        <th> 所属医院 </th>
                                        <th class="hidden-xs"> 所属科室 </th>
                                        <th class="hidden-xs"> 科室地址 </th>
                                        <th class="hidden-xs"> 固定电话 </th>
                                        <th> 手机 </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td> 1 </td>
                                        <td> 扬州贝恩口腔医院有限公司 </td>
                                        <td class="hidden-xs"> 所属科室</td>
                                        <td class="hidden-xs"> 科室地址科室地址科室地址科室地址科室地址 </td>
                                        <td class="hidden-xs"> 12345667899</td>
                                        <td> 123456789012 </td>
                                    </tr>
                                    <tr>
                                        <td> 2 </td>
                                        <td> 海宁通策口腔医院有限公司 </td>
                                        <td class="hidden-xs"> 所属科室</td>
                                        <td class="hidden-xs"> 科室地址科室地址科室地址科室地址科室地址 </td>
                                        <td class="hidden-xs"> 123456789012</td>
                                        <td> 123456789012 </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-12"><strong>医生资格证:</strong></div>
                    </div>
                    <div class="row">
                        <div class="col-xs-3">
                            <img src="http://m.bestdoctor1.com/Areas/hsmy/Content/img/bg.jpg?17fe3b8" class="img-responsive">
                        </div>
                        <div class="col-xs-3">
                            <img src="http://m.bestdoctor1.com/Areas/hsmy/Content/img/bg.jpg?17fe3b8" class="img-responsive">
                        </div>
                        <div class="col-xs-3">
                            <img src="http://m.bestdoctor1.com/Areas/hsmy/Content/img/bg.jpg?17fe3b8" class="img-responsive">
                        </div>
                    </div>
                    <hr />
                    <div class="row">
                        <div class="col-xs-12">
                            <ul class="list-unstyled">
                                <li>
                                    <strong>备注:</strong> 
                                    ａ）正式在职：有入职时间 ，没有离职时间<br/>
                                    ｂ）正式离职：有入职时间，有离职时间<br />
                                    Ｃ）实习在职：没有入职时间，没有离职时间。有实习开始时间，没有实习结束时间<br />
                                    Ｄ）实习离职：没有入职时间，没有离职时间。有实习开始时间，有实习结束时间<br />
                                    Ｆ）实习转正：有入职时间，没有离职时间。有实习开始时间，没有实习结束时间ａ）正式在职：有入职时间 ，没有离职时间<br />
                                    ｂ）正式离职：有入职时间，有离职时间<br />
                                </li>
                            </ul>
                        </div>
                    </div>

                </div>


            </div>
            <div class="modal-footer">

                <button type="button" class="btn dark btn-outline" data-dismiss="modal">关闭</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>




@section scripts
{
    <script>
        $(function() {
            $("#btnSearch").click(function () {
                if ($("#Filter").val() == "") {
                    location.href = '@Url.Action("DoctorList")';
                    return;
                }
                var reloadUrlWithFilter = '@Url.Action("DoctorList")?filter=' + encodeURI($("#Filter").val());
                location.href = reloadUrlWithFilter;
            });
        })
        var app = new Vue({
            el: '#app',
            data: {
                doctorObj: "",
                sort_keys:[]
            },
            created: function () {
                console.log(Cookies.get('sf_doctorData_sort_keys_sort_keys'))
                if (Cookies.get('sf_doctorData_sort_keys_sort_keys')) this.sort_keys = JSON.parse(Cookies.get('sf_doctorData_sort_keys_sort_keys'))
            },
            mounted: function () { 
                console.log(this.SortDirect_RealName)
                console.log(this.SortDirect_AuditStatus)
            },
            computed: {
                SortDirect_RealName: function () {
                    var _tmp = _.where(this.sort_keys, { SortProperty: "RealName" });
                    if (!_tmp && _tmp.length === 0) return '';
                    return(_tmp && _tmp.length > 0 && _tmp[0].SortDirect === 1 ? "Desc" : "Asc");                 
                },
                SortDirect_AuditStatus: function () {
                    var _tmp = _.where(this.sort_keys, { SortProperty: "Doctor.AuditStatus" });
                    if (!_tmp && _tmp.length === 0) return '';
                    return (_tmp && _tmp.length > 0 && _tmp[0].SortDirect === 1 ? "Desc" : "Asc");
                }
            },
            methods: {
                click_showDoctorPop: function (doctorObj) {            
                    this.doctorObj = doctorObj.NagigatedDomainObject
                    console.log(this.doctorObj)
                   $('#modelfull').modal('show')
                },
                click_setsort: function (Name) {
                    var _tmp = _.where(this.sort_keys, { SortProperty: Name });                 
                    var SortDirect = (_tmp && _tmp.length>0 && _tmp[0].SortDirect===1 ? "Desc" : "Asc");
                    $.post("/ajaxcommon/setsort/", {
                        "ModuleName": "sf_doctorData_sort_keys",
                        "SortProperty": Name,     //ID, RealName, Doctor.DoctorCode, Doctor.AuditStatus
                        "SortDirect": SortDirect  //Asc或者Desc
                    }).then(item => {
                        console.log(item)
                        window.location.reload();
                      });
                }

            }
        })
    </script>
}
